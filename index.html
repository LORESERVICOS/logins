<!doctype html>
<script>
const WEBAPP_URL = "https://script.google.com/macros/s/AKfycbzwxBa-DDtruDJFQhBEPonsRnrv0jb2gB7etz9EsoEj9MGuXmDs0hJpab0Tv7zXoMgq/exec"; 
// exemplo: https://script.google.com/macros/s/AKfycbXXXX/exec

const $ = (id) => document.getElementById(id);

// limpa sess√£o ao abrir
sessionStorage.removeItem("auth_ok");

$("btn").onclick = async () => {

  $("msg").textContent = "Validando...";

  const usuario = $("usuario").value.trim();
  const senha = $("senha").value.trim();

  if (!usuario || !senha) {
    $("msg").textContent = "Preencha usu√°rio e senha.";
    return;
  }

  try {

    const resp = await fetch(WEBAPP_URL, {
      method: "POST",
      headers: {
        "Content-Type": "text/plain;charset=utf-8"   // üî• ESSA LINHA RESOLVE
      },
      body: JSON.stringify({
        tipo: "login",
        usuario: usuario,
        senha: senha
      })
    });

    const data = await resp.json();

    if (data.status !== "ok") {
      $("msg").textContent = data.message || "Login inv√°lido";
      $("senha").value = "";
      return;
    }

    sessionStorage.setItem("auth_ok", "1");

    $("usuario").value = "";
    $("senha").value = "";

    window.location.href = data.redirect || "pagina.html";

  } catch (e) {
    $("msg").textContent = "Erro de conex√£o/URL do WebApp.";
    console.error("Erro real:", e);
  }

};

</script>
